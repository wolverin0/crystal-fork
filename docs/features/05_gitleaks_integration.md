# Feature: Security Guard (Gitleaks)

**Date Added:** January 11, 2026
**Status:** Live

## Overview
Gitleaks is now integrated as a background security service in Crystal. It acts as a "Worker Bee" that proactively scans all code generated by AI agents for hardcoded secrets, API keys, and credentials before they are committed to the codebase.

## Features
*   **Real-time Scanning:** Automatically scans every "turn" of an AI session (stdout and JSON output) for potential leaks.
*   **Automatic Alerting:** If a secret is detected, Crystal immediately reports it as a Session Error and logs it to `MEMORIES.md`.
*   **Zero-Configuration:** Uses Gitleaks' best-in-class default rules to identify AWS keys, GitHub tokens, Slack secrets, and 100+ other credential types.
*   **Worktree Support:** Capable of scanning entire session worktrees on demand via IPC.

## Technical Implementation
*   **Backend (`GitleaksService`):** A high-performance wrapper around the `gitleaks` binary, utilizing stdin piping for memory-efficient scanning.
*   **Integration (`SessionManager`):** Intercepts session output streams to perform non-blocking security checks.
*   **IPC:** New channels `security:scan-content`, `security:scan-worktree`, and `security:get-status`.

## How to Use
This feature works **automatically** in the background. If an agent tries to write a secret (e.g., `export AWS_KEY="..."`), you will see a security alert appear in the session view immediately.
