# Integrated Tools & Features

**Status:** Completed (Phase 1)
**Date:** January 11, 2026

Crystal is evolving from a simple session manager into a comprehensive "Agent IDE". This document outlines the integrated external tools that are now live in the Crystal workflow.

## 1. Visual Git Management (Lazygit)

**Goal:** Replace the manual "Step 3: Review Diffs" CLI pain with a full TUI (Terminal User Interface).

*   **Integration Point:** A new "Lazygit" panel in the Session View.
*   **Mechanism:**
    *   Crystal spawns a `lazygit` process inside the session's worktree.
    *   The terminal panel renders the TUI via xterm.js.
*   **Why:** Allows interactive staging/discarding of specific lines (hunks) generated by the agent.
*   **Status:** **Live**. Integrated via `LazygitPanel` and `LazygitManager`.

## 2. Advanced Security (Gitleaks)

**Goal:** Prevent agents from accidentally committing secrets (API keys, credentials) to the codebase.

*   **Integration Point:** The "Worker Bee" (Crystal Mind) and Pre-Commit Hooks.
*   **Mechanism:**
    *   **Real-time:** Crystal pipes session output to `gitleaks detect --pipe` in the background.
*   **Action:**
    *   If leak detected -> Block action or alert user via Notification.
    *   Log to `MEMORIES.md` with `[SECURITY CRITICAL]` tag.
*   **Status:** **Live**. Integrated into `SessionManager` background scanning.

## 3. Environment Isolation (Direnv)

**Goal:** Allow different sessions to run with different configurations without polluting the global environment.

*   **Integration Point:** Session Initialization.
*   **Mechanism:**
    *   Crystal checks for `.env` files in the worktree root.
    *   It parses and injects these variables into the `env` object of all spawned processes.
*   **Why:** Essential for safe testing. An agent can be given a "sandbox" database credential in its specific session environment.
*   **Status:** **Live**. Integrated into `TerminalPanelManager` and `DirenvService`.

## 4. Auto-Test & Feedback (Watchexec)

**Goal:** Create an instant feedback loop where code is tested the millisecond it is saved.

*   **Integration Point:** Background Session Service.
*   **Mechanism:**
    *   Crystal spawns a `watchexec` process for each active session monitoring for file changes.
    *   **Workflow:** Triggers the project's "Auto-Test Command" and reports failures as Session Errors.
*   **Why:** Removes the "Did it work?" turn from the conversation, speeding up development.
*   **Status:** **Live**. Integrated into session startup and error reporting.

## 5. Visual Testing (Claude in Chrome / Embedded Browser)

**Goal:** Allow agents to "see" and test the web application they are building directly within Crystal.

*   **Integration Point:** Embedded Browser Panel.
*   **Mechanism:**
    *   Uses Electron's native `WebContentsView` to render a live browser.
    *   Docked side-by-side with the code and logs.
*   **Status:** **Live**. Integrated via `BrowserPanel` and `BrowserViewManager`.

## 6. Local Voice Alerts (Piper TTS)

**Goal:** "Ambient Computing" alerts for critical events without requiring visual attention.

*   **Integration Point:** Background Services.
*   **Mechanism:**
    *   Use **Piper TTS** (fast, local, neural TTS).
    *   When "Crystal Mind" detects a critical pattern (e.g., "Build Failed" or "Secret Leaked"), it synthesizes a brief audio alert.
*   **Why:** Zero latency, 100% privacy voice notifications.
*   **Status:** **Live**. Integrated into `SessionManager` error handling.

## Summary Roadmap

1.  **Completed:** Lazygit, Gitleaks, Watchexec, Embedded Browser, Direnv, Piper TTS.
2.  **Next:** Global "Crystal Mind" LLM Analyzer (The Architect) and Agent Interoperability (Google A2A).