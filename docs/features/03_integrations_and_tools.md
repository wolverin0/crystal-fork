# Integrated Tools & Features

**Status:** Planned / In Progress
**Date:** January 11, 2026

Crystal is evolving from a simple session manager into a comprehensive "Agent IDE". This document outlines the roadmap for integrating external best-in-class tools directly into the Crystal workflow.

## 1. Visual Git Management (Lazygit)

**Goal:** Replace the manual "Step 3: Review Diffs" CLI pain with a full TUI (Terminal User Interface).

*   **Integration Point:** A new "Git Review" panel in the Session View.
*   **Mechanism:**
    *   Crystal spawns a `lazygit` process inside the session's worktree.
    *   The terminal panel renders the TUI.
*   **Why:**
    *   Allows interactive staging/discarding of specific lines (hunks) generated by the agent.
    *   Visual conflict resolution for merges.
*   **Status:** **Live**. Integrated via `LazygitPanel` and `LazygitManager`.

## 2. Advanced Security (Gitleaks)

**Goal:** Prevent agents from accidentally committing secrets (API keys, credentials) to the codebase.

*   **Integration Point:** The "Worker Bee" (Crystal Mind) and Pre-Commit Hooks.
*   **Mechanism:**
    *   **Real-time:** Before the Worker Bee analyzes a diff, it pipes the content to `gitleaks detect --no-git --pipe`.
    *   **Pre-commit:** Crystal runs `gitleaks protect` on the worktree before allowing a "Squash & Merge".
*   **Action:**
    *   If leak detected -> Block action.
    *   Alert user via Notification.
    *   Log to `MEMORIES.md` with `[SECURITY CRITICAL]` tag.
*   **Status:** **Live**. Integrated into `SessionManager` background scanning.

## 3. Environment Isolation (Direnv)

**Goal:** Allow different sessions to run with different configurations (e.g., Test DB vs Dev DB) without polluting the global environment.

*   **Integration Point:** Session Initialization.
*   **Mechanism:**
    *   When creating a session, Crystal checks for `.envrc` or `.env.session` in the worktree root.
    *   It parses these variables and injects them into the `env` object of the `pty` (pseudo-terminal) spawned for Claude/Codex.
*   **Why:** Essential for safe testing. An agent can be given a "sandbox" database credential in its specific session environment.
*   **Status:** **Live**. Integrated into `TerminalPanelManager` and `DirenvService`.

## 4. Auto-Test & Feedback (Watchexec)
...
*   **Why:** Replaces expensive/slow cloud APIs like ElevenLabs. Zero latency, 100% privacy.
*   **Status:** **Live**. Integrated into `SessionManager` error handling.

## Summary Roadmap

1.  **Completed:** Lazygit, Gitleaks, Watchexec, Embedded Browser, Direnv, Piper TTS.
